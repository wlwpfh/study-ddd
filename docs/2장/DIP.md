## 2.3 DIP

가격 할인을 계산하려면 고객의 정보를 구하고 룰을 이용해서 할인 금액을 구해야 한다.  
이는 고수준 모듈이다.  

이를 RDMS에서 JPA로 구한다, Drools로 룰를 적용한다는 저수준 모듈이라 볼 수 있다.  

**고수준 모듈이란?**  
- 의미 있는 단일 기능을 제공하는 모듈  
- 고수준 모듈이 제대로 동작하려면 저수준 모듈을 사용해야 한다.  

DIP는 이 문제를 해결하기 위해 저수준 모듈이 고수준 모듈에 의존하도록 바꾼다.  
`CalculateDiscountService`는 룰 적용을 Drools로 했는지 궁요한 것이 아니다. 
고객 정보와 구매 정보에 룰을 적용해서 할인 금액을 구한다는 것이 중요할 뿐이다.  

`CalculateDiscountService`에는 Drools에 의존하는 코드가 없다. 단지 RuleDiscounter가 룰을 적용한다는 사실만 알 수 있다.  
실제 `RuleDiscounter`의 구현 객체는 생성자를 통해 전달받는다. (이것을 상속받아 구현한다는 점이 중요한 부분이다!!)  

DIP를 이용하여 `CalculateDiscountService`는 더 이상 구현 기술인 Drools에 의존하지 않는다.  
룰을 이용한 할인 금액 계산을 추상화한 RuleDiscounter 인터페이스에 의존할 뿐이다.  
룰을 이용한 할인 금액 계산은 고수준 모듈의 개념으로 `RuleDiscounter` 인터페이스는 고수준 모듈에 속한다.  

`DroolsRuleDiscounter`는 고수준의 하위 기능인 `RuleDiscounter`를 구현한 것으로 저수준 모듈에 속한다.  

고수준 모듈이 저수준 모듈을 사용하려면 고수준 모듈이 저수준 모듈에 의존해야 하는데,
반대로 저수준 모듈이 고수준 모듈에 의존한다고 해서 이를 DIP(의존 역전 원칙)이라 부른다.    


고수준 모듈은 더 이상 저수준 모듈에 의존하지 않고 구현을 추상화한 인터페이스에 의존한다. 


### 주의사항  
핵심은 고수준 모듈이 저수준 모듈에 의존하지 않도록 하기 위함이다.  
이를 적용할 때 하위 기능을 추상화한 인터페이스는 고수준 모듈 관점에서 도출한다.


### DIP와 아키텍처  
인프라스트럭처 영역은 구현 기술을 다루는 저수준 모듈이고 응용 영역과 도메인 영역은 고수준 모듈이다.  
인프라스트럭처 영역이 응용 영역과 도메인 영역에 의존하는 구조가 된다.  