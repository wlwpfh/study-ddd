## 도메인 영역의 주요 구성요소  

1. 엔티티 Entity
- 고유 식별자를 갖는 객체로 자신의 라이프 사이클을 갖는다.  
- 주문, 회원, 상품과 같이 도메인의 고유한 개념을 표현한다.

2. 벨류 Value  
- 고유 식별자를 갖지 않는 객체로 주로 개념적으로 하나인 값을 표현할 때 사용한다.  
- 배송지 주소를 표현하기 위한 주소나 구매 금액을 위한 금액과같은 타입이 밸류 타입니다.  
- 엔티티 속성으로 사용할 뿐만 아니라 다른 벨류 타입의 속성으로도 사용할 수 있다.  

3. 애그리거트  
- 연관된 엔티티와 밸류 객체를 개념적으로 하나로 묶은 것이다.  
- 예를 들어 주문과 관련된 Order, OrderLine, Orderer를 주문 애그리거트로 묶을 수 있다.  

4. 레포지토리  
- 도메인 모델의 영속성을 처리한다.  
- 예를 들어 DBMS 테이블에서 엔티티 객체를 로딩하거나 저장하는 기능을 제공한다.  

5. 도메인 서비스  
- 특정 엔티티에 속하지 않는 도메인 로직을 제공한다.  
- 할인 금액 계산은 상품, 쿠폰, 회원 등급, 구매 금액 등 다양한 조건을 이용해서 구현하게 된다. 
- 도메인 로직이 여러 엔티티와 밸류를 필요로 하면 도메인 서비스에서 로직을 구현한다.  


### 1. 엔티티
- 도메인 모델의 데이터를 포함하여 해당 데이터와 관련된 기능을 함께 제공한다.  
```java
    public class Order {
        // 주문 도메인 모델의 데이터
        private OrderNo orderNo;
        private Orderer orderer;
        private ShippingInfo shippingInfo;
        
        // 도메인 모델 엔티티는 도메인 기능도 함께 제공
        public void changeShippingInfo(ShippingInfo shippingInfo){
            ...
        }
}
```
도메인 모델의 엔티티는 데이터를 담고 있는 구조라기보다는 데이터와 함께 기능을 제공하는 객체이다.  
도메인 관점에서 기능을 구현하고 기능 구현을 캡슐화해서 데이터가 임의로 변경되는 것을 막는다.  

벨류는 불변으로 구현할 것을 권장하며, 이는 엔티티의 벨류 타입 데이터를 변경할 때는 객체 자체를 완전히 교체한다는 것을 의미한다.  

### 2. 애그리거트  
- 규모가 커질수록 도메인 모델의 구성요소는 복잡해진다.  
- 도메인 모델도 개별 객체뿐만 아니라 상위 수준에서 모델을 볼 수 있어야 전체 모델의 관계와 개별 모델을 이해하는데 도움이 된다.  
- 이를 이해하는데 도움이 되는 것은 바로 애그리거트이다.  

이는 관련 객체를 하나로 묶은 군집이다.  
주문, 배송지 정보, 주문자, 주문 목록, 총 결제 금액이란 하위 개념을 표현한 모델을 하나로 묶어서 주문이라는 상위 개념으로 표현할 수 있다.


애그리거트는 군집에 속한 객체를 관리하는 루트 엔티티를 갖는다.  
루트 엔티티는 애그리거트에 속해 있는 엔티티와 벨류 객체를 이용해서 애그리거트가 구현해야 할 기능을 제공한다.  

예를 들어 애그리거트 루트인 Order는 주문 도메인 로직에 맞게 애그리거트의 상태를 관리한다.
배송지 정봅 변경 기능은 배송지를 변경할 수 있는지 확인한 후에 배송지 정보를 변경한다.  

주문 애그리거트는 Order를 통하지 않고 shippinginfo를 변경할 수 있는 방법을 제공하지 않는다.    
배송지를 변경하려면 루트 엔티티인 Order를 사용해야 하므로 배송지 정보를 변경할 때에는 order가 구현한 도메인 로직을 항상 따르게 된다.  


### 3. 리포지터리  
- RDBMS, NoSQL, 로컬 파일과 같은 물리적인 저장소에 도메인 객체를 보관해야 한다.  
- 이를 위한 도메인 모델이 리포지터리이다. 
- 엔티티나 밸류가 요구사항에서 도출되는 도메인 모델이라면 리포지터리는 구현을 위한 도메인 모델이다.  

- 애그리거트 단위로 도메인 객체를 저장하고 조회하는 기능을 정의한다.  
- 도메인 모델 관점에서 리포지토리는 도메인 객체를 영속화하는 데 필요한 기능을 추상화한 것으로 고수준 모듈에 속한다.  
- 기반 기술을 이용해서 이를 구현한 클래스는 저수준 모듈로 인프라스트럭처 영역에 속한다.  

### 4. 정리  
웅용 서비스는 의존 주입과 같은 방식을 사용해서 실제 리포지터리 구현 객체에 접근한다.  


리포지터리는 응용 서비스가 필요로하는 메서드를 제공한다. 
1. 애그리거트를 저장하는 메소드
2. 애그리거트 루트 식별자로 애그리거트를 조회하는 메소드  
